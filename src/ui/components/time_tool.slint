import { LineEdit, VerticalBox, HorizontalBox, GroupBox, ComboBox } from "std-widgets.slint";
import { Label, CustomButton } from "./common.slint";
import { Colors } from "../themes/colors.slint";
import { Fonts } from "../themes/fonts.slint";

export struct TimeFormat {
    text: string,
    value: string,
}

export component TimeToolComponent {
    in-out property <string> current-time: "";
    in-out property <string> result: "";
    in-out property <string> time-format: "%Y-%m-%d %H:%M:%S";
    in-out property <[string]> format-texts: [
        "YYYY-MM-DD HH:mm:ss",
        "YYYY/MM/DD HH:mm:ss",
        "YYYY年MM月DD日 HH:mm:ss",
        "YYYY-MM-DD",
        "YYYY/MM/DD",
        "YYYY年MM月DD日",
        "HH:mm:ss",
        "HH:mm",
        "YYYY-MM-DD HH:mm",
        "YYYY/MM/DD HH:mm",
        "MM-DD HH:mm",
        "MM/DD HH:mm",
        "YYYY-MM-DD HH:mm:ss.SSS"
    ];
    in-out property <[string]> format-values: [
        "%Y-%m-%d %H:%M:%S",
        "%Y/%m/%d %H:%M:%S",
        "%Y年%m月%d日 %H:%M:%S",
        "%Y-%m-%d",
        "%Y/%m/%d",
        "%Y年%m月%d日",
        "%H:%M:%S",
        "%H:%M",
        "%Y-%m-%d %H:%M",
        "%Y/%m/%d %H:%M",
        "%m-%d %H:%M",
        "%m/%d %H:%M",
        "%Y-%m-%d %H:%M:%S.%3f"
    ];
    private property <int> current-format-index: 0;

    callback request-current-time();
    callback convert-to-timestamp(string);
    callback convert-to-ms-timestamp(string);
    callback time-format-changed(string);

    init => {
        // 初始化操作（可根据需要保留）
    }

    VerticalBox {
        spacing: 16px;

        GroupBox {
            title: "时间格式";
            VerticalBox {
                spacing: 8px;
                HorizontalBox {
                    spacing: 16px;
                    VerticalBox {
                        alignment: start;
                        Label {
                            text: "选择格式：";
                        }
                        ComboBox {
                            current-index: root.current-format-index;
                            width: 300px;
                            model: root.format-texts;
                            selected => {
                                root.current-format-index = self.current-index;
                                root.time-format = root.format-values[self.current-index];
                                root.time-format-changed(root.time-format);
                            }
                        }
                    }
                }
            }
        }

        GroupBox {
            title: "当前时间";
            VerticalBox {
                spacing: 8px;
                HorizontalBox {
                    spacing: 8px;
                    alignment: space-between;
                    LineEdit { 
                        text: current-time;
                        width: 300px;
                    }
                    CustomButton { 
                        text: "获取当前时间";
                        clicked => { root.request-current-time() }
                    }
                }
            }
        }

        GroupBox {
            title: "时间转换";
            VerticalBox {
                spacing: 16px;

                // 日期时间转换
                VerticalBox {
                    spacing: 8px;
                    Label { text: "日期时间转换："; }
                    Text {
                        text: "请按照格式 \"" + root.format-texts[root.current-format-index] + "\" 输入";
                        font-size: Fonts.size-small;
                        color: Colors.text-secondary;
                    }
                    HorizontalBox {
                        spacing: 8px;
                        property <string> datetime-input: "";
                        LineEdit { 
                            text <=> parent.datetime-input;
                            width: 300px;
                            placeholder-text: "例如：2023-04-01 12:30:45";
                        }
                        CustomButton { 
                            text: "转秒级";
                            clicked => { root.convert-to-timestamp(parent.datetime-input) }
                        }
                        CustomButton { 
                            text: "转毫秒级";
                            clicked => { root.convert-to-ms-timestamp(parent.datetime-input) }
                        }
                    }
                }

                // 转换结果
                VerticalBox {
                    spacing: 8px;
                    Label { text: "转换结果："; }
                    LineEdit { 
                        text: result;
                        width: 400px;
                        read-only: true;
                    }
                }
            }
        }
    }
} 